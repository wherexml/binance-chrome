# Binance Alpha Daily Analyzer - 重构版本

基于binance-gpt优化的币安Alpha交易数据分析Chrome扩展程序，采用API拦截+DOM解析双重机制，更智能、更准确。

## 主要改进

### ✅ 解决的问题
- **翻页在第6页停止** → 新的翻页逻辑更可靠
- **统计数据不准确** → 双重数据获取机制确保准确性
- **磨损成本计算错误** → 采用更精确的计算公式

### 🚀 新特性
- **API拦截** + **DOM解析**双重数据获取
- **多日数据统计**：支持统计多天的交易数据，通过日期标签切换查看
- **智能时间范围**：自动按日期的8:00-次日8:00统计（如8月14日8:00到8月15日8:00）
- **日期标签切换**：直观的日期标签显示每日交易金额，点击切换查看详情
- **Alpha积分计算**：自动计算总交易额并显示对应积分档位
- **积分进度显示**：显示当前档位、分数、下一档位差距
- **网页直接展示**：结果直接在页面显示，无需下载查看
- **更智能翻页**：适配多种分页按钮样式
- **简化界面**：移除配置按钮，自动使用最佳设置

## 文件结构

```
binance-chrome/
├── manifest.json     # 扩展配置文件
├── content.js        # 主要逻辑（重构版本）
├── pageHook.js       # API拦截脚本
├── test_pagination.js # 翻页测试脚本（改进版）
└── README.md         # 说明文档
```

## 安装使用

1. **加载扩展**
   - 打开 `chrome://extensions/`
   - 开启"开发者模式"  
   - 点击"加载已解压的扩展程序"
   - 选择binance-chrome文件夹

2. **使用步骤**
   - 访问币安Alpha交易历史页面
   - 页面右下角会出现"统计交易数据"按钮
   - 点击按钮开始自动分析（自动翻页获取所有数据）
   - 分析完成后弹出多日统计结果窗口
   - 通过顶部日期标签切换查看不同日期的交易详情
   - 每个标签显示日期和当日交易金额总额
   - 可点击"导出统计汇总"保存代币汇总数据
   - 可点击"导出详细记录"保存当前日期的所有交易明细

## 核心功能

### 数据抓取机制
- **API拦截**：自动捕获网络请求中的订单数据
- **DOM解析**：从页面表格解析数据作为备用
- **去重合并**：按订单ID+时间戳去重，确保数据唯一性

### 智能翻页
```javascript
// 支持多种分页按钮
const candidates = [
  'button[aria-label*="下一页"]',
  'li[title*="下一页"] button', 
  'button[aria-label*="Next"]',
  'li.ant-pagination-next button',
  'button:has(svg[aria-label*="right"])'
];
```

### 磨损成本算法
```
磨损成本 = max(0, (买入均价 - 卖出均价) × min(买入总量, 卖出总量))
```

### Alpha积分系统
按照官方积分表格，根据总买入金额计算积分：
- 积分档位按2的次方递增：$2=1分, $4=2分, $8=3分...
- 最高档位：$134,217,728 = 27分
- 只统计买入交易的金额，不包括卖出金额
- 自动显示当前达标档位、分数、距离下一档位差距

## 时间范围逻辑

插件自动按照以下规则统计数据：
- **8月14日** = 2024-08-14 08:00:00 到 2024-08-15 08:00:00
- **8月15日** = 2024-08-15 08:00:00 到 2024-08-16 08:00:00
- 以此类推...

这样设计是因为交易通常跨越自然日，按早8点划分更符合实际交易习惯。

## 测试工具

运行翻页测试脚本：
```javascript
// 在浏览器控制台粘贴test_pagination.js内容
// 会在右上角显示测试结果
```

## 技术优势

1. **双重保障**：API+DOM双数据源确保完整性
2. **智能适配**：支持中英文界面，多种分页样式
3. **性能优化**：异步处理，避免页面卡顿
4. **错误恢复**：网络异常时自动重试

## 结果展示

### 网页表格显示
- **多日标签切换**：顶部显示所有有数据的日期标签，点击切换查看
- **标签信息**：每个日期标签显示简化日期（如8/14）和当日交易总金额
- **实时显示**：统计完成后直接在页面弹出结果表格
- **时间范围**：显示当前查看日期的具体统计时间范围
- **Alpha积分**：显示当日总买入金额、档位分数、下一档位差距
- **活动提醒**：显示"BSC活动倍数自行计算"提示
- **汇总信息**：显示代币数量和总磨损成本
- **颜色标识**：磨损成本用红色显示损失，绿色显示盈利

### CSV导出格式

**统计汇总CSV**：
- 代币名称
- 买入总额（USDT）
- 卖出总额（USDT）  
- 磨损成本（USDT）

数据按磨损成本从高到低排序，便于识别最大损失项目。

**详细记录CSV**：
- 时间：完整的交易时间
- 代币：交易的代币名称
- 方向：买入/卖出
- 平均价格：交易的平均价格
- 价格：交易价格
- 已成交：成交数量和代币单位
- 数量：交易数量和代币单位
- 成交额：交易金额（USDT）
- 状态：订单状态

详细记录按时间倒序排列，包含当日所有交易的完整信息。

## 故障排除

如遇问题：
1. 打开浏览器控制台查看日志
2. 运行test_pagination.js检查翻页状态
3. 确认在正确的Alpha订单历史页面
4. 检查扩展权限是否正确设置

## 版本历史

### v0.1.0 (当前版本)
- ✅ 重构为API拦截+DOM解析双重机制
- ✅ 解决翻页停止和统计错误问题
- ✅ 简化界面，移除不必要的popup和background
- ✅ 优化磨损成本计算算法
- ✅ 增加实时配置选项

---

**免责声明**: 本插件仅提供数据分析功能，不构成投资建议。交易有风险，投资需谨慎。